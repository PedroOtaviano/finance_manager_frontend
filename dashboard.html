<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Finance Manager - Dashboard</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css"
    />
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>

    <script>
      function updateBalance() {
        htmx.trigger("#balance", "load");
      }

      window.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");

        if (!token) {
          alert("Você precisa estar logado para acessar o dashboard.");
          window.location.href = "index.html";
          return;
        }

        document.body.addEventListener("htmx:configRequest", function (event) {
          event.detail.headers["Authorization"] = "Bearer " + token;
        });

        htmx.trigger("#balance", "load");
        htmx.trigger("#trends", "load");
        htmx.trigger("#transactions", "load");
      });

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "index.html";
      }
    </script>

    <style>
      /* Paleta escura */
      body {
        background-color: #121212;
        color: #e5e5e5;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }
      h1,
      h2 {
        color: #60a5fa; /* Azul suave */
      }
      .card {
        background: #1e1e1e;
        padding: 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
        margin-bottom: 1.5rem;
      }
      .positive {
        color: #22c55e;
        font-weight: bold;
      }
      .negative {
        color: #ef4444;
        font-weight: bold;
      }
      .logout {
        background: #ef4444;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.4rem;
        cursor: pointer;
      }
      .logout:hover {
        background: #dc2626;
      }
      form {
        display: grid;
        gap: 1rem;
      }
      form select,
      form input,
      form button {
        width: 100%;
        background: #2a2a2a;
        color: #e5e5e5;
        border: 1px solid #3f3f3f;
      }
      form button {
        background: #3b82f6;
        border: none;
        color: white;
        font-weight: bold;
      }
      form button:hover {
        background: #2563eb;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      table th,
      table td {
        padding: 0.75rem;
        border-bottom: 1px solid #333;
      }
      table th {
        color: #93c5fd;
        text-align: left;
      }
      table tr:hover {
        background: #2a2a2a;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Conta Pessoal</h1>
        <button class="logout" onclick="logout()">Sair</button>
      </header>

      <!-- Saldo atual -->
      <section class="card">
        <h2>Saldo Atual</h2>
        <div
          id="balance"
          hx-get="http://127.0.0.1:8000/dashboard/summary_html?month=10&year=2025"
          hx-swap="innerHTML"
        >
          Carregando saldo...
        </div>
      </section>

      <!-- Tendência -->
      <section class="card">
        <h2>Tendência dos últimos meses</h2>
        <div
          id="trends"
          hx-get="http://127.0.0.1:8000/dashboard/trends_html?months=6"
          hx-swap="innerHTML"
        >
          Carregando gráfico...
        </div>
      </section>

      <!-- Transações -->
      <section class="card">
        <h2>Transações</h2>
        <div
          id="transactions"
          hx-get="http://127.0.0.1:8000/transactions/html"
          hx-swap="innerHTML"
        >
          Carregando transações...
        </div>
      </section>

      <!-- Nova transação -->
      <section class="card">
        <h2>Adicionar Transação</h2>
        <form
          hx-post="http://127.0.0.1:8000/transactions/html"
          hx-ext="json-enc"
          hx-encoding="json"
          hx-target="#transactions"
          hx-swap="outerHTML"
          hx-on="htmx:afterRequest: updateBalance"
        >
          <select name="category_id" required>
            <option value="1">Salário</option>
            <option value="2">Aluguel</option>
            <option value="3">Transporte</option>
          </select>

          <select name="type" required>
            <option value="income">Receita</option>
            <option value="expense">Despesa</option>
          </select>

          <input type="number" name="amount" placeholder="Valor" required />
          <input type="date" name="date" required />
          <input type="text" name="note" placeholder="Observação (opcional)" />

          <button type="submit">Adicionar</button>
        </form>
      </section>
    </main>
  </body>
</html>
